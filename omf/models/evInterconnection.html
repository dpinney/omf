<head>
	<title>Open Modeling Framework</title>
	<meta charset="utf-8">
	<link href="{{pathPrefix}}/static/omf.css" type="text/css" rel="stylesheet"/>
	<link rel="shortcut icon" href="{{pathPrefix}}/static/favicon.ico">
	<style>
	/*Styles here*/
		table {
			border-collapse: collapse;
			width: 100%;
		}
		table, th, td {
			border: 1px solid black;
			text-align: center;
			padding-top: 10px;
			padding-bottom: 10px;
		}
		th {
			background-color: #8c8c8c;
		}
		tr:nth-child(even) {
			background-color: #e6e6e6;
		}
	</style>
	{% if modelStatus == "running" %}<meta http-equiv="refresh" content="5"/>{% endif %}
	<!-- Library Imports -->
	<script type="text/javascript" src="{{pathPrefix}}/static/omf.js"></script>
	<script type="text/javascript" src="{{pathPrefix}}/static/jquery-1.9.1.js"></script>
	<!-- Data  Imports -->
	<script>allInputData={% if allInputDataDict %}{{allInputDataDict | tojson}}{% else %}null{% endif %}</script>
	<script>allOutputData={% if allOutputDataDict %}{{allOutputDataDict | tojson}}{% else %}null{% endif %}</script>
	<script>modelStatus="{{modelStatus}}"</script>
	<script>currentUser="{{datastoreNames.get('currentUser','test')}}"</script>
	<script type="text/javascript">
		function editFeeder(modelName, feederNum) {
			console.log("modelName:",modelName)
			studyUser = allInputData.user
			window.open("/feeder/" + studyUser + "/" + modelName + "/" + feederNum,  "_blank")
		}
	</script>
</head>
<body onload="init()">
	<div id="header">
		<div id="headInnerBlock">
			<div id="menuLeft">
				<a style="color:white" href="/">Open Modeling Framework</a> &#187;&nbsp;&nbsp;Model
				&#8220;<p id="titleText" style="display:inline"></p>&#8221;
			</div>
		</div>
	</div>
	<div id="triangle-parent">
		<div id="triangle-message">New Version<span class="classic-triangle">A new version of the model has been added to the OMF. To get the new outputs, please fill in any missing inputs and hit "Run Model". You can also just look at the old inputs/outputs.</span></div>
		<div id="triangle-topright"></div>
	</div>
	<p class="reportTitle">Model Input</p>
	<div id="input" class="content">
			<form name="inputForm" action="/runModel/" onsubmit="event.preventDefault(); return isFormValid();" method="post">
			<div class="shortInput">
				<label>Model Type <a href="https://github.com/dpinney/omf/wiki/Models-~-voltageDrop" target="blank">Help?</a></label>
				<input type="text" id="modelType" name="modelType" value="{{modelName}}" readonly/>
			</div>
			<div class="shortInput">
				<label>Model Name</label>
				<input type="text" id="modelName" name="modelName" pattern="^[\w\s\d\.-]+$" required="required">
			</div>
			<div class="shortInput runningInline postRunInline">
				<label>User</label>
				<input type="text" id="user" name="user" readonly/>
			</div>
			<div class="runningInline postRunInline shortInput">
				<label>Created</label>
				<input type="text" id="created" name="created" readonly/>
			</div>
			<div class="postRunInline shortInput">
				<label>Run Time</label>
				<input type="text" id="runTime" name="runTime" readonly/>
			</div>
			<div class="shortInput">
				<label>Feeder</label>
				<button id="feederButton" type="button" onclick="javascript:editFeeder(allInputData.modelName,1);" style="display:block;width:125px;">Open Editor</button>
				<input type="text" id="feederName1" name="feederName1" style="display:none">
			</div>
			<div class="shortInput">
				<label class="tooltip">Layout Algorithm<span class="classic">Geospatial shows the circuit the same way it was defined in the feeder editor. Force Directed uses an algorithm to show the circuit elements evenly spaced (useful for circuits without location data).</span></label>
				<select id="layoutAlgorithm" name="layoutAlgorithm">
					<option value="geospatial">Geospatial</option>
					<option value="forceDirected">Force Directed</option>
				</select>
			</div>
			<div class="shortInput">
				<label class="tooltip">Battery Size (kWh)<span class="classic">Specify the size of the Vehicle's battery in kWh.</span></label>
				<input type="text" id="batterySize" name="batterySize" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Charge Rate (kW)<span class="classic">Specify the charge rate of the vehicle in kW.</span></label>
				<input type="text" id="chargeRate" name="chargeRate" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Efficiency (mpk)<span class="classic">Specify the efficiency of the vehicle in mpk.</span></label>
				<input type="text" id="efficiency" name="efficiency" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Gas Efficiency (mpg)<span class="classic">Specify the gas efficiency of the vehicle in mpg.</span></label>
				<input type="text" id="gasEfficiency" name="gasEfficiency" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Number of Vehicles<span class="classic">Specify the number of vehicles.</span></label>
				<input type="text" id="numVehicles" name="numVehicles" pattern="^\d+$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Cost of Energy ($/kWh)<span class="classic">Specify the energy cost in $/kWh.</span></label>
				<input type="text" id="energyCost" name="energyCost" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Arrival Start Hour<span class="classic">Specify the hour in the day in which the charging should start (0-23).</span></label>
				<input type="text" id="startHour" name="startHour" pattern="^([0-9]|1[0-9]|2[0-3])$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Arrival End Hour<span class="classic">Specify the hour in the day in which the charging should end (0-23).</span></label>
				<input type="text" id="endHour" name="endHour" pattern="^([0-9]|1[0-9]|2[0-3])$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Charge Limit (kW)<span class="classic">Specify the charge limit in kW.</span></label>
				<input type="text" id="chargeLimit" name="chargeLimit" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Minimum Necessary Charge (%)<span class="classic">Specify the minimum charge needed for a vehicle in percent of the battery (0-100%).</span></label>
				<input type="text" id="minCharge" name="minCharge" pattern="^\d{1,3}\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Maximum Necessary Charge (%)<span class="classic">Specify the maximum charge needed for a vehicle in percent of the battery (0-100%).</span></label>
				<input type="text" id="maxCharge" name="maxCharge" pattern="^\d{1,3}\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Fuel Cost ($/gal)<span class="classic">Specify the cost of gas in $/gallon.</span></label>
				<input type="text" id="gasCost" name="gasCost" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Vehicle Workload<span class="classic">Specify the workload of each vehicle in miles/vehicle/day.</span></label>
				<input type="text" id="workload" name="workload" pattern="^\d+\.?\d*?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Load Name<span class="classic">Specify the load name in the circuit.</span></label>
				<input type="text" id="loadName" name="loadName" required="required"/>
			</div>
			<!-- <div class="shortInput" style="width:100%">
				<label class="tooltip">Hourly Load Shape<span class="classic">Please enter a list of 24 values separated by commas to represent a "peak day" load shape by hour.</span></label>
				<input type="text" id="loadShape" name="loadShape" pattern="^(\d*\.?\d*)(,\s*\d*\.?\d*){23}$" required="required"/>
			</div> -->
			<div class="shortInput">
				<label class="tooltip">Hourly Load Shape<span class="classic">Please enter the name of a .csv file representing the hourly load shape</span></label>
				<input type="text" id="loadShape" name="loadShape" pattern="^([a-zA-Z0-9\s_\\.,\-\(\):])+(.csv)$" required="required"/>
			</div>
			<div class="wideInput" style="text-align:right">
				<button id="deleteButton" type="button" class="stoppedInline postRunInline" onclick="deleteModel()">Delete</button>
				<button id="publishButton" type="button" class="postRunInline" onclick="publishModel()">Publish</button>
				<button id="duplicateButton" type="button" class="postRunInline" onclick="duplicateModel()">Duplicate</button>
				<button id="cancelButton" class="runningInline" type="button" onclick="cancelModel()">Cancel Run</button>
				<button id="runButton" class="stoppedInline postRunInline" type="submit">Run Model</button>
			</div>
		</form>
	</div>
	<div id ="runIndicator" class="content running">
		Model running on server. Refresh the page to check for results, or wait for automatic refresh every 5 seconds.
	</div>
	<div id ="stopIndicator" class="content stopped" style="visibility: hidden">
		<pre id='errorText' style='overflow-x:scroll'></pre>
		<script type="text/javascript">
		if (typeof(allInputData.stderr) !== 'undefined') {
			gebi('stopIndicator').style.visibility = 'visible'
			gebi('errorText').innerHTML = 'MODEL ENCOUNTERED AN ERROR AS FOLLOWS: \n\n' + allInputData.stderr}
		</script>
	</div>
	<div id="output">
		<p class="reportTitle postRun" style="page-break-before:always">EV Charging Demand</p>
		<div id="evChargingDemand" class="tightContent postRun">
			<img id="evChargingDemandChart" style="width:1000px;height:auto;" />
			<script type="text/javascript">gebi("evChargingDemandChart").src = "data:image/png;base64," + allOutputData.evChargingDemand</script>
		</div>
		<p class="reportTitle postRun" style="page-break-before:always">Fuel Cost Comparison</p>
		<div id="fuelCostCalc" class="tightContent postRun">
			{{ allOutputDataDict['fuelCostCalcHtml'] }}
		</div>
		<p class="reportTitle postRun" style="page-break-before:always">Voltage Drop Diagram without Charging Load</p>
		<div id="voltageDropDiagram" class="tightContent postRun">
			<img id="voltageDropChart" style="width:1000px;height:1000px;" />
			<script type="text/javascript">gebi("voltageDropChart").src = "data:image/png;base64," + allOutputData.voltageDrop</script>
		</div>
		<p class="reportTitle postRun" style="page-break-before:always">Protective Device Status without Charging Load</p>
		<div id="protDevStatus" class="tightContent postRun">
			{{ allOutputDataDict['protDevTableHtml'] }}
		</div>
		<p class="reportTitle postRun" style="page-break-before:always">Combined Load Shape Carpet Plot</p>
		<div id="carpetPlot" class="tightContent postRun">
			<img id="carpetPlotChart" style="width:1000px;height:auto;" />
			<script type="text/javascript">gebi("carpetPlotChart").src = "data:image/png;base64," + allOutputData.carpetPlot</script>
		</div>
	</div>
</body>